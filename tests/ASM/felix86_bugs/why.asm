%ifdef CONFIG
{
  "RegData": {
    "XMM0": ["0x3f0000003f000000", "0x0000000000000000"],
    "XMM1": ["0x4215fffc4215fffc", "0x4215fffc4215fffc"],
    "XMM2": ["0x3f000000", "0x0000000000000000"],
    "XMM3": ["0x3f800000", "0x0"],
    "XMM4": ["0x3f0000003f000000", "0x0"],
    "XMM5": ["0x3f000000", "0x0000000000000000"]
  }
}
%endif

bits 64

lea rsp, [rel data]

mov rax, 0x3f800000
movq xmm0, rax
movq xmm14, rax
movq xmm3, rax

; This block of code would cause bugs due to our bad vmv understanding
; took like a week to find out why we had a bunch of random problems
movaps xmm12, [rsp+0x80]
; movss xmm14, dword [0x0000003FC2385C68]
movaps xmm13, [rsp+0x90]
movdqa xmm10, [rsp+0xF0]
subss xmm12, xmm0
movaps xmm1, xmm12
addss xmm1, xmm14
cvtss2si r9, dword [rsp+0x10]
; movdqa xmm3, [0x0000003FC237D770]
movdqa xmm0, xmm10
pand xmm0, xmm3
pshufd xmm2, xmm0, 0x55
ucomiss xmm0, xmm2
movaps xmm4, xmm13
subps xmm4, [rsp+0x70]
; movaps xmm0, [0x0000003FC237FBE0]
addps xmm0, xmm4
movaps xmm5, xmm0
andps xmm5, xmm3
pshufd xmm2, xmm5, 0x55
addss xmm2, xmm5
jnb .boop
mov eax, 1
hlt
.boop:
mov eax, 0
hlt



data:
dd 0xf7a80060, 0x0000003f, 0x4215fffc, 0x00000000
dd 0x3f800000, 0x0000003f, 0x00000001, 0x00000000
dd 0xf7a80000, 0x0000003f, 0xc0866d48, 0x0000003f
dd 0x42e10000, 0x0000003f, 0x3f000000, 0x00000000
dd 0x43ce4000, 0x43ce4000, 0x43ce4000, 0x43ce4000
dd 0x3f000000, 0x4215fffc, 0x00000000, 0x00000000
dd 0xd16a9710, 0x0000003f, 0x00010010, 0x00000000
dd 0x42e00000, 0x43ce0000, 0x00000000, 0x00000000
dd 0x4215fffc, 0x4215fffc, 0x4215fffc, 0x4215fffc
dd 0x42e10000, 0x43ce4000, 0x00000000, 0x00000000
dd 0x43bb8000, 0x43bb8000, 0x43bb8000, 0x43bb8000
dd 0xc0866d48, 0x0000003f, 0xc0867180, 0x0000003f
dd 0xc0866d48, 0x0000003f, 0x00000007, 0x00000000
dd 0xf7a800d0, 0x0000003f, 0xc154cf3c, 0x0000003f
dd 0x00000000, 0x4215fffc, 0x00000000, 0x00000000
dd 0x00000000, 0x43bb8000, 0x00000000, 0x00000000
dd 0xf7a80130, 0x0000003f, 0xc155119c, 0x0000003f
dd 0x00000000, 0x00000000, 0x00000000, 0x00000000
dd 0x48095440, 0x43bb8000, 0x00000000, 0x00000000
dd 0xf7a80140, 0x0000003f, 0xcfac5c80, 0x0000003f
dd 0x00000001, 0x00000000, 0xd16f17b0, 0x0000003f
dd 0xd16f17a0, 0x0000003f, 0xcfac5c80, 0x0000003f
dd 0xd16f17a0, 0x0000003f, 0xcfac5c80, 0x0000003f
dd 0xf7a80180, 0x0000003f, 0xc155133f, 0x0000003f
dd 0x00000000, 0x00000000, 0xcfac5c80, 0x0000003f
dd 0x00000004, 0x00000000, 0xd16f17b0, 0x0000003f
dd 0xd16f17a0, 0x0000003f, 0xcfac5c80, 0x0000003f
dd 0xf7a801c0, 0x0000003f, 0xc154d9df, 0x0000003f
dd 0xffff4000, 0xffff4000, 0x00000460, 0x00000000
dd 0xc3403ac0, 0x0000003f, 0x00000001, 0x00000000
dd 0x00000000, 0x00000000, 0x00000020, 0x00000000
dd 0xf7a80270, 0x0000003f, 0xc1557f31, 0x0000003f
dd 0x00000008, 0x00000008, 0xd16f17a0, 0x0000003f
dd 0x00000046, 0x00000000, 0x000008a2, 0x00000000
dd 0x00000010, 0x00000000, 0x00000460, 0x00000000
dd 0xf7a80230, 0x0000003f, 0xc32af46c, 0x0000003f
dd 0x00000045, 0x00000045, 0x00000046, 0x00000000
dd 0x00000460, 0x00000000, 0x00000046, 0x00000000
dd 0xf7a80270, 0x0000003f, 0xc1556f89, 0x0000003f
dd 0xcfa40320, 0x0000003f, 0xf7a80590, 0x0000003f
dd 0xcfa40320, 0x0000003f, 0x00000000, 0x00000000
dd 0xcfac5c80, 0x0000003f, 0x00000000, 0x00000000
dd 0xf7a802d0, 0x0000003f, 0xc147c25e, 0x0000003f
dd 0xd16f17a0, 0x0000003f, 0x00000045, 0x0000003f
dd 0x00000046, 0x00000000, 0xc1478f57, 0x0000003f
dd 0x00000024, 0x00000000, 0x00000000, 0x00000000
dd 0xf7a80590, 0x0000003f, 0xcfa40320, 0x0000003f
dd 0x00000000, 0x00000000, 0xf7a80338, 0x0000003f
dd 0xf7a80560, 0x0000003f, 0xc147937a, 0x0000003f
dd 0xd16aa340, 0x0000003f, 0x00000001, 0x00000000
